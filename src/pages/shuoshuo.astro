---
import MainGridLayout from "../layouts/MainGridLayout.astro";
---

<MainGridLayout title="è¯´è¯´" description="ç¢ç¢å¿µä¸å³åˆ»è®°å½•">
  <div class="flex w-full rounded-[var(--radius-large)] overflow-hidden relative min-h-32">
    <div class="card-base z-10 px-4 py-4 md:px-6 md:py-5 relative w-full">
      <div class="relative max-w-4xl mx-auto">
        <!-- é¡µé¢å¤´éƒ¨ -->
        <div class="moments-header mb-6">
          <div class="header-content">
            <div class="header-info">
              <h1 class="moments-title text-xl md:text-2xl lg:text-3xl font-bold text-90 mb-1">ğŸ“¢ è¯´è¯´</h1>
              <p class="moments-subtitle text-sm md:text-base lg:text-lg text-75">è®°å½•ä¸€äº›çµæ„Ÿä¸ç¢è¯­</p>
            </div>
          </div>
        </div>

        <!-- è¯´è¯´å®¹å™¨ -->
        <div class="moments-timeline">
          <div id="my-shouts-container" class="timeline-list space-y-4"></div>
        </div>

        <!-- åº•éƒ¨æç¤º -->
        <div class="moments-tips text-center mt-6 md:mt-8 lg:mt-10 text-75 text-xs md:text-sm lg:text-base italic">
          Powered by Qexo
        </div>
      </div>
    </div>
  </div>

  <!-- å¤–éƒ¨èµ„æº -->
  <link rel="stylesheet" href="https://cdn.cbd.int/kemiaofxjun-cdn@1.0.3/css/qexo-talk/talk.css" />

  <!-- ä¿®å¤åçš„åˆå§‹åŒ–è„šæœ¬ -->
<script>
  // ä¿®å¤æ ¸å¿ƒï¼šå¤„ç†Astroé¡µé¢å¯¼èˆªçš„åˆå§‹åŒ–é—®é¢˜
  function loadTalkScript() {
    // å¦‚æœè„šæœ¬å·²åŠ è½½ï¼Œç›´æ¥åˆå§‹åŒ–
    if (window.myQexoShouts) {
      initQexo();
      return;
    }
    
    // åˆ›å»ºè„šæœ¬æ ‡ç­¾
    const script = document.createElement('script');
    script.src = "https://cdn.cbd.int/kemiaofxjun-cdn@1.0.3/js/qexo-talk/talk.js";
    script.defer = true;
    
    // æˆåŠŸåŠ è½½ååˆå§‹åŒ–
    script.onload = () => {
      if (typeof myQexoShouts !== "undefined") {
        initQexo();
      } else {
        console.error("talk.js åŠ è½½å¤±è´¥");
      }
    };
    
    // åŠ è½½å¤±è´¥å¤„ç†
    script.onerror = () => {
      console.error("æ— æ³•åŠ è½½è¯´è¯´è„šæœ¬");
    };
    
    document.head.appendChild(script);
  }

  // åˆå§‹åŒ–å‡½æ•°ï¼ˆå¢åŠ DOMå…ƒç´ æ£€æŸ¥ï¼‰
  function initQexo() {
    // ç¡®ä¿å®¹å™¨å…ƒç´ å·²ç»å­˜åœ¨
    const container = document.getElementById('my-shouts-container');
    if (!container) {
      // ç¨åé‡è¯•ï¼ˆé’ˆå¯¹å¯¼èˆªåœºæ™¯ï¼‰
      setTimeout(initQexo, 50);
      return;
    }
    
    // æ¸…ç©ºå®¹å™¨é˜²æ­¢é‡å¤å†…å®¹
    container.innerHTML = '';
    
    // åˆå§‹åŒ–è¯´è¯´
    myQexoShouts.init({
      el: "#my-shouts-container",
      avatar: "https://img.314926.xyz/images/2025/08/13/no-background-kemiaofxjun.webp",
      name: "å…‹å–µçˆ±åƒå¤é¢",
      limit: 10,
      baseURL: "https://qexo.kemeow.top",
    }).catch(err => {
      console.error("åˆå§‹åŒ–å¤±è´¥:", err);
    });
  }

  // é¦–æ¬¡åŠ è½½å’ŒAstroå¯¼èˆªäº‹ä»¶å¤„ç†
  if (document.readyState === 'complete') {
    loadTalkScript();
  } else {
    window.addEventListener('load', loadTalkScript);
  }
  
  // ç›‘å¬Astroé¡µé¢å¯¼èˆªäº‹ä»¶
  document.addEventListener('astro:page-load', () => {
    // å¢åŠ å»¶æ—¶ç¡®ä¿DOMå®Œå…¨æ›´æ–°
    setTimeout(loadTalkScript, 100);
  });
</script>
</MainGridLayout>